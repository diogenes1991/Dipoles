CXX=g++
FC=gfortran

## Absolute path to that folder, which contains the sub-process code (and 
## folders if in olp mode) for the particular process in question.  E. g. 
## PROCPATH=$(Home)/pp_ttbar/ if in olp mode, or simply PROCPATH=./ if in 
## single sub-process mode, ... For now needed in single sub-process mode
## for compatibility with olp mode.
# PROCPATH=/ABSOLUTE/PATH/OF/PROCESS/FOLDER/
MEDIR = /home/diogenes1991/NLOX/tests/AA_bbbar_NEW/AA_bbbar_EW/code

PROCPATH=$(MEDIR)

#CFLAGS= -Wall -Wno-reorder
CFLAGS= -Og -Wall -Wno-reorder -DNLOXPROCPATH=\"$(PROCPATH)\" -DQCDLOOP
FFLAGS= 

QCDLOOPDIR=/home/diogenes1991/NLOX_util/built/NLOX_util/{lib,lib64}
LOOPTOOLSDIR=/home/diogenes1991/NLOX_util/built/NLOX_util
TREDDIR=/home/diogenes1991/NLOX/src/tred
PSBDIR=/home/diogenes1991/NLOX/src/kinematics/particle_scattering_base
CUBADIR=/home/diogenes1991/NLOX/tests/AA_bbbar_NEW
LHAPDFDIR=/home/diogenes1991/NLOX/tests/AA_bbbar_NEW
IRPOLEDIR=/home/diogenes1991/local



#QCDLOOP2DIR=/home/diogenes1991/NLOX_util/built/NLOX_util/qcdloop-2.0.3
ONELOOPDIR=/home/diogenes1991/NLOX_util/built/../OneLOop-3.6

BORN_DIR0=$(MEDIR)/../born_g0e2_g0e2/C
VIRT_DIR0=$(MEDIR)../virt_g0e2_g0e4/C
CT_DIR0=$(MEDIR)/../CT_g0e2_g0e4/C

COMMON_INC=-I$(TREDDIR) \
	-I$(PSBDIR) \
	-I$(IRPOLEDIR)/include \
        -I.

COMMON_LIB_DIRS=-L$(QCDLOOPDIR) \
	-L$(QCDLOOPDIR)/ql \
	-L$(QCDLOOPDIR)/ff \
	-L$(TREDDIR) \
	-L$(PSBDIR)

COMMON_LIBS=-lparticle_scattering_base -Wl,-rpath,$(TREDDIR) -ltred -lquadmath -lgcc -lstdc++ -lm

ifdef QCDLOOPDIR
CFLAGS+=-DQCDLOOP
COMMON_LIB_DIRS+=-L$(QCDLOOPDIR) \
        -L$(QCDLOOPDIR)/ql \
        -L$(QCDLOOPDIR)/ff
COMMON_LIBS+=-lqcdloop -lff
fortran_needed = yes
endif

ifdef LOOPTOOLSDIR
CFLAGS+=-DLOOPTOOLS
COMMON_INC+=-I$(LOOPTOOLSDIR)/include
COMMON_LIB_DIRS+=-L$(LOOPTOOLSDIR)/lib -L$(LOOPTOOLSDIR)/lib64
COMMON_LIBS+=-looptools
fortran_needed = yes
endif

ifdef QCDLOOP2DIR
CFLAGS+=-DQCDLOOP2 -std=gnu++11
COMMON_INC+=-I$(QCDLOOP2DIR)/include
COMMON_LIB_DIRS+=-L$(QCDLOOP2DIR)/lib
COMMON_LIBS+=-Wl,-Bstatic -lqcdloop2 -Wl,-Bdynamic
endif

ifdef ONELOOPDIR
CFLAGS+=-DONELOOP
COMMON_INC+=-I$(ONELOOPDIR)/example_cpp
COMMON_LIB_DIRS+=-L$(ONELOOPDIR)/lib
COMMON_LIB_DIRS+=-L$(ONELOOPDIR)
COMMON_LIBS+=-lavh_olo
fortran_needed = yes
endif

ifdef fortran_needed
COMMON_LIBS+=-lgfortran
endif

TEST_INC=$(COMMON_INC)
TEST_INC+=-I$(MEDIR)
CUBA_INC=$(COMMON_INC) -I$(CUBADIR) -I$(LHAPDFDIR)/include

TEST_LIB_DIRS=$(COMMON_LIB_DIRS)
CUBA_LIB_DIRS=$(COMMON_LIB_DIRS) -L$(CUBADIR) -L$(LHAPDFDIR)/lib

TEST_LIBS=$(COMMON_LIBS)
CUBA_LIBS=$(COMMON_LIBS) -lcuba -lLHAPDF

BORN_OBJS0=$(patsubst %.cc,%.o,$(wildcard $(BORN_DIR0)/*.cc))
VIRT_OBJS0=$(patsubst %.cc,%.o,$(wildcard $(VIRT_DIR0)/*.cc))
CT_OBJS0=$(patsubst %.cc,%.o,$(wildcard $(CT_DIR0)/*.cc))
ALL_OBJECTS=$(patsubst %.cc,%.o,$(wildcard $(MEDIR)*.cc)) $(BORN_OBJS0) $(VIRT_OBJS0) $(CT_OBJS0)

TEST_OBJ=$(filter-out main_cuba.o histogram.o integrand.o olp_f.o, $(ALL_OBJECTS))
FTEST_OBJ=$(filter-out main.o main_cuba.o histogram.o integrand.o olp.o, $(ALL_OBJECTS))
CUBA_OBJ=$(filter-out main.o olp_f.o, $(ALL_OBJECTS))

all: show

show:
	@echo 'Objects = '
	@echo $(TEST_OBJ)
	@echo 'Includes = '
	@echo $(TEST_INC)
	@echo 'Libraries directories = '
	@echo $(TEST_LIB_DIRS)
	@echo 'Libraries = '
	@echo $(TEST_LIBS)

test: $(TEST_OBJ)
	$(CXX) $(CFLAGS) -o test $(TEST_INC) $(TEST_LIB_DIRS) $(TEST_OBJ) $(TEST_LIBS)

library: $(TEST_OBJ)
	$(CXX) $(CFLAGS) -o NLOX_OLP.a $(TEST_INC) $(TEST_LIB_DIRS) $(TEST_OBJ) $(TEST_LIBS)

# compile:
# 	$(CXX) $()

fortran: $(FTEST_OBJ) ftest.f90
	$(FC) $(FFLAGS) -c ftest.f90 -o ftest.o
	$(FC) $(FFLAGS) -o ftest $(TEST_INC) $(TEST_LIB_DIRS) $(FTEST_OBJ) ftest.o $(TEST_LIBS)

# -Wno-write-strings added only for call to setct14_ in main_cuba.cc.
main_cuba.o: main_cuba.cc
	$(CXX) $(CFLAGS) -Wno-unused -Wno-write-strings $(CUBA_INC) -c $< -o $@

cuba: $(CUBA_OBJ) CT14Pdf.f
	$(FC) $(FFLAGS) -O3 -c CT14Pdf.f -o CT14Pdf.o
	$(CXX) $(CFLAGS) -Wl,-rpath,$(LHAPDFDIR)/lib -o cuba $(CUBA_INC) $(CUBA_LIB_DIRS) $(CUBA_OBJ) CT14Pdf.o $(CUBA_LIBS)

%.o: %.cc
	$(CXX) $(CFLAGS) $(CUBA_INC) -c $< -o $@

clean:
	rm -f *# *.tmp *~ $(ALL_OBJECTS)

plots:
	./merge.py
	gnuplot plots.gnu
	ps2pdf plots.ps
